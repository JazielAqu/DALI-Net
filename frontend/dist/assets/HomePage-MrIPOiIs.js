import{u as B,a as U,r as C,b as S,j as a,g as A,c as $,m as L}from"./index-BKVowuDS.js";import{F as G}from"./FollowButton-DUcpTJpX.js";const H=()=>{var f,v;const{currentUser:t,setUser:m}=B(),c=U(),[p,F]=C.useState(""),[M,P]=C.useState({}),{data:o,isLoading:D,error:u}=S({queryKey:["members"],queryFn:()=>L.getAll({limit:1e3}),staleTime:5*60*1e3}),{data:l}=S({queryKey:["member-self-home",t==null?void 0:t.id],queryFn:()=>L.getById(t.id),enabled:!!(t!=null&&t.id),staleTime:5*60*1e3}),n=((f=o==null?void 0:o.data)==null?void 0:f.data)||[],d=(v=l==null?void 0:l.data)==null?void 0:v.data,g=d&&!n.some(e=>e.id===d.id)?[d,...n]:n,h=p.trim().toLowerCase(),j=h?g.filter(e=>{var s,r;return((s=e.name)==null?void 0:s.toLowerCase().includes(h))||((r=e.bio)==null?void 0:r.toLowerCase().includes(h))}):g,T=e=>A([e.profileImage,e.picture,e.image],M,"/default-avatar.jpg"),q=e=>{const s=e.locked===!0,r=A([e.profileImage,e.picture,e.image],{},"/default-avatar.jpg");!t&&!s?(async()=>{var y,k,w,I;try{const i=await $.demoLogin(e.id),b=(k=(y=i==null?void 0:i.data)==null?void 0:y.data)==null?void 0:k.token,E=((I=(w=i==null?void 0:i.data)==null?void 0:w.data)==null?void 0:I.user)||e;b&&localStorage.setItem("authToken",b),m({...E,profileImage:r,image:r,picture:r})}catch(i){console.warn("Demo login failed, falling back to local persona only",i),m({...e,profileImage:r,image:r,picture:r})}finally{c(`/profile/${e.id}`)}})():c(`/profile/${e.id}`)},x=e=>{const s=[];return e.dev&&s.push("Dev"),e.des&&s.push("Design"),e.pm&&s.push("PM"),e.core&&s.push("Core"),e.mentor&&s.push("Mentor"),s};return a.jsxs("div",{className:"home-page",children:[a.jsxs("div",{className:"home-hero",children:[a.jsx("h1",{children:"Welcome to DALI Net"}),a.jsx("p",{children:"Connect with DALI lab members and share your projects!"})]}),a.jsxs("div",{className:"user-selection card",children:[a.jsx("h2",{children:"Select a User to Get Started"}),a.jsx("p",{className:"user-selection-hint",children:"Choose a member to view their profile and interact with the platform"}),a.jsx("div",{className:"search-box",children:a.jsx("input",{type:"text",className:"input",placeholder:"Search members...",value:p,onChange:e=>F(e.target.value)})}),D?a.jsx("div",{className:"spinner"}):u?a.jsxs("div",{className:"error-message",children:[a.jsxs("p",{children:["Error loading members: ",u.message]}),a.jsx("p",{children:"Make sure the backend server is running on http://localhost:3001"})]}):j.length===0?a.jsxs("div",{className:"empty-state",children:[a.jsx("p",{children:"No members found."}),a.jsxs("p",{children:["Make sure you've run the seeder: ",a.jsx("code",{children:"cd backend && npm run seed"})]})]}):a.jsx("div",{className:"members-grid",children:j.map(e=>a.jsxs("div",{className:"member-card",onClick:()=>q(e),children:[a.jsx("img",{src:T(e),alt:e.name,className:"member-card-avatar",onError:s=>{s.target.onerror=null;const r=s.target.src;P(N=>({...N,[r]:!0})),s.target.src="/default-avatar.jpg"}}),a.jsxs("div",{className:"member-card-header",children:[a.jsx("h3",{className:"member-card-name",children:e.name}),e.role&&a.jsx("p",{className:"member-card-role",children:e.role})]}),x(e).length>0&&a.jsx("div",{className:"member-badges",children:x(e).map(s=>a.jsx("span",{className:"badge",children:s},s))}),t&&t.id!==e.id&&a.jsx("div",{className:"member-card-actions",onClick:s=>s.stopPropagation(),children:a.jsx(G,{followerId:t.id,followingId:e.id})})]},e.id))})]}),t&&a.jsxs("div",{className:"welcome-back card",children:[a.jsxs("h2",{children:["Welcome back, ",t.name,"!"]}),a.jsxs("div",{className:"welcome-actions",children:[a.jsx("button",{className:"btn btn-primary",onClick:()=>c("/feed"),children:"Go to Feed"}),a.jsx("button",{className:"btn btn-secondary",onClick:()=>c(`/profile/${t.id}`),children:"View Profile"})]})]})]})};export{H as default};
