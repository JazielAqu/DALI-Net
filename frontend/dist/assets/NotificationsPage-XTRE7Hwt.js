import{u as v,d as b,b as k,e as u,r as A,j as s,L as C,o}from"./index-BKVowuDS.js";const M=()=>{var h,j;const{currentUser:i}=v(),l=b(),{data:n,isLoading:x}=k({queryKey:["notifications",i==null?void 0:i.id],queryFn:()=>o.getByUser(i==null?void 0:i.id,{limit:100}),enabled:!!(i!=null&&i.id)}),g=u({mutationFn:e=>o.markAsRead(e),onSuccess:()=>{l.invalidateQueries({queryKey:["notifications",i==null?void 0:i.id]})}}),m=u({mutationFn:()=>o.markAllAsRead(i==null?void 0:i.id),onSuccess:()=>{l.invalidateQueries({queryKey:["notifications",i==null?void 0:i.id]})}}),f=u({mutationFn:()=>o.clearAll(i==null?void 0:i.id),onSuccess:()=>{l.invalidateQueries({queryKey:["notifications",i==null?void 0:i.id]})}}),N=u({mutationFn:e=>o.delete(e),onSuccess:()=>{l.invalidateQueries({queryKey:["notifications",i==null?void 0:i.id]})}}),d=((h=n==null?void 0:n.data)==null?void 0:h.data)||[],c=((j=n==null?void 0:n.data)==null?void 0:j.unreadCount)||0;A.useEffect(()=>{c>0&&m.mutate()},[c]);const p=e=>{if(!e)return"just now";if(e.toDate)return e.toDate().toLocaleString();if(typeof e=="number"||typeof e=="string"){const t=new Date(e);return Number.isNaN(t.getTime())?"just now":t.toLocaleString()}if(e._seconds||e.seconds){const r=(e._seconds??e.seconds)*1e3+Math.floor((e._nanoseconds??e.nanoseconds??0)/1e6);return new Date(r).toLocaleString()}const a=new Date(e);return Number.isNaN(a.getTime())?"just now":a.toLocaleString()},y=e=>e.postId?"/feed":e.relatedUserId?`/profile/${e.relatedUserId}`:null;return i?s.jsxs("div",{className:"notifications-page",children:[s.jsxs("div",{className:"notifications-header",children:[s.jsx("h1",{className:"page-title",children:"Notifications"}),s.jsxs("div",{className:"notifications-actions",children:[s.jsx("button",{className:"btn btn-secondary",onClick:()=>m.mutate(),disabled:m.isPending||c===0,title:c===0?"No unread notifications":"Mark all as read",children:"Mark all as read"}),s.jsx("button",{className:"btn btn-secondary",onClick:()=>f.mutate(),disabled:f.isPending||d.length===0,title:d.length===0?"No notifications to clear":"Clear all notifications",children:"Clear all notifications"})]})]}),x?s.jsx("div",{className:"spinner"}):d.length===0?s.jsx("div",{className:"card",children:s.jsx("div",{className:"no-notifications",children:s.jsx("p",{children:"No notifications yet"})})}):s.jsx("div",{className:"notifications-list",children:d.map(e=>{const a=y(e),t=s.jsxs("div",{className:`notification-card ${e.read?"":"unread"}`,onClick:()=>{e.read||g.mutate(e.id)},children:[s.jsxs("div",{className:"notification-content",children:[s.jsx("p",{className:"notification-text",children:e.content}),s.jsx("span",{className:"notification-time",children:p(e.createdAt)})]}),!e.read&&s.jsx("div",{className:"unread-indicator"}),s.jsx("button",{className:"notification-delete",onClick:r=>{r.preventDefault(),r.stopPropagation(),N.mutate(e.id)},disabled:N.isPending,title:"Delete notification",children:"âœ•"})]});return a?s.jsx(C,{to:a,children:t},e.id):s.jsx("div",{children:t},e.id)})})]}):s.jsx("div",{className:"notifications-page",children:s.jsx("div",{className:"card",children:s.jsx("p",{children:"Please select a user from the home page to view notifications."})})})};export{M as default};
