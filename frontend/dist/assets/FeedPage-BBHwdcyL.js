import{u as C,d as q,r as o,e as I,p as j,j as e,b as E}from"./index-9FpdTuGE.js";import{P as U}from"./PostCard-CQg7iVU0.js";const A=()=>{const{currentUser:s}=C(),i=(s==null?void 0:s.role)==="guest",u=q(),[a,m]=o.useState(""),[c,n]=o.useState(""),[d,l]=o.useState(""),[y,h]=o.useState(""),[P,p]=o.useState(!1),[N,g]=o.useState(""),f=I({mutationFn:t=>j.create(t),onSuccess:()=>{m(""),n(""),l(""),h(""),g(""),p(!1),u.invalidateQueries({queryKey:["feed"]}),u.invalidateQueries({queryKey:["posts"]})}}),S=t=>{if(t.preventDefault(),!a.trim()||i)return;const r=(d||c).trim();f.mutate({authorId:s.id,content:a.trim(),imageUrl:r})},F=t=>{var b;const r=(b=t.target.files)==null?void 0:b[0];if(!r){h(""),n(""),l("");return}if(!r.type.startsWith("image/")){g("Please select an image file");return}if(r.size>3*1024*1024){g("Image must be under 3MB");return}g(""),h(r.name),n("");const x=new FileReader;x.onload=()=>{var v;l(((v=x.result)==null?void 0:v.toString())||"")},x.readAsDataURL(r)};return i?null:P?e.jsx("div",{className:"create-post card",children:e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"create-post-header",children:[e.jsx("h3",{children:"Create Post"}),e.jsx("button",{type:"button",className:"close-btn",onClick:()=>p(!1),children:"Ã—"})]}),e.jsx("textarea",{className:"create-post-input",placeholder:"What's on your mind?",value:a,onChange:t=>m(t.target.value),rows:4,required:!0}),e.jsxs("label",{className:"file-input-label",children:[e.jsx("span",{children:"Choose image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:F,className:"file-input"})]}),y&&e.jsxs("div",{className:"selected-file",children:["Selected: ",y]}),e.jsx("input",{type:"url",className:"input",placeholder:"Image URL (optional)",value:c,onChange:t=>n(t.target.value),style:{marginBottom:"1rem"}}),N&&e.jsx("div",{className:"error-message",children:N}),d&&e.jsx("div",{className:"selected-file",children:"Image selected and ready to upload."}),e.jsxs("div",{className:"create-post-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>p(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:f.isPending||!a.trim(),children:f.isPending?"Posting...":"Post"})]})]})}):e.jsx("div",{className:"create-post-trigger",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>p(!0),children:"+ Create Post"})})},R=({userId:s,mode:i="all"})=>{var d;const{currentUser:u}=C(),{data:a,isLoading:m,error:c}=E({queryKey:["feed",s,i],queryFn:()=>i==="following"&&s?j.getFeed(s):j.getAll(),enabled:i==="all"||!!s});if(m)return e.jsx("div",{className:"feed-container",children:e.jsx("div",{className:"spinner"})});if(c)return e.jsx("div",{className:"feed-container",children:e.jsxs("div",{className:"error-message",children:["Error loading feed: ",c.message]})});const n=((d=a==null?void 0:a.data)==null?void 0:d.data)||[];return e.jsxs("div",{className:"feed-container",children:[u&&e.jsx(A,{}),n.length===0?e.jsx("div",{className:"empty-feed",children:e.jsx("p",{children:"No posts yet. Be the first to post!"})}):e.jsx("div",{className:"feed-posts",children:n.map(l=>e.jsx(U,{post:l},l.id))})]})};export{R as F};
