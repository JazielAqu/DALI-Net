import{u as I,a as D,r,b as M,e as S,j as e,h as q,m as v}from"./index-Dm03hG7C.js";const w={name:"",year:"",major:"",minor:"",birthday:"",home:"",quote:"",favoriteThing1:"",favoriteThing2:"",favoriteThing3:"",favoriteDartmouthTradition:"",funFact:"",profileImage:"",dev:!1,des:!1,pm:!1,core:!1,mentor:!1},B=()=>{const{currentUser:i,needsProfile:x,setNeedsProfile:C,setUser:N}=I(),c=D();r.useEffect(()=>{i||c("/login"),(i==null?void 0:i.role)==="guest"&&c("/")},[i,c]);const{data:u,isLoading:k}=M({queryKey:["member",i==null?void 0:i.id],queryFn:()=>v.getById(i.id),enabled:!!(i!=null&&i.id),retry:!1}),j=r.useMemo(()=>{var l;const a=((l=u==null?void 0:u.data)==null?void 0:l.data)||{};return{...w,...a}},[u]),[s,m]=r.useState(j),[b,d]=r.useState(""),[y,f]=r.useState("");r.useEffect(()=>{m(j)},[j]);const p=S({mutationFn:a=>v.update(i.id,a),onSuccess:()=>{N(a=>({...a||{},name:s.name||(a==null?void 0:a.name),profileImage:s.profileImage||(a==null?void 0:a.profileImage),image:s.profileImage||(a==null?void 0:a.image),picture:s.profileImage||(a==null?void 0:a.picture)})),C(!1),localStorage.setItem("needsProfile","false"),c(`/profile/${i.id}`)},onError:a=>{var t,n,g;const l=((g=(n=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:n.error)==null?void 0:g.message)||(a==null?void 0:a.message)||"Could not save your profile. Please try again.";d(l)}}),o=a=>l=>{m(t=>({...t,[a]:l.target.value}))},h=a=>l=>{m(t=>({...t,[a]:l.target.checked}))},P=async a=>{var t;const l=(t=a.target.files)==null?void 0:t[0];if(!l){f("");return}if(!l.type.startsWith("image/")){d("Please choose an image file");return}try{d(""),f("Uploading...");const n=await q(l,i.id);m(g=>({...g,profileImage:n})),f(l.name)}catch(n){d((n==null?void 0:n.message)||"Could not upload image"),f("")}},F=a=>{a.preventDefault(),d(""),p.mutate({...s,completedProfile:!0})},T=x?"Create your DALI profile":"Update your profile";return!i||i.role==="guest"?null:e.jsx("div",{className:"profile-form-page",children:e.jsxs("div",{className:"card profile-form-card",children:[e.jsx("h1",{children:T}),e.jsx("p",{className:"muted",children:"Tell us about yourself. You can edit this later."}),k?e.jsx("div",{className:"spinner"}):e.jsxs("form",{className:"profile-form",onSubmit:F,children:[e.jsxs("div",{className:"grid two-col",children:[e.jsxs("label",{children:["Name",e.jsx("input",{value:s.name,onChange:o("name"),required:!0})]}),e.jsxs("label",{children:["Year",e.jsx("input",{value:s.year,onChange:o("year"),placeholder:"2025"})]}),e.jsxs("label",{children:["Major",e.jsx("input",{value:s.major,onChange:o("major")})]}),e.jsxs("label",{children:["Minor",e.jsx("input",{value:s.minor,onChange:o("minor")})]}),e.jsxs("label",{children:["Birthday (MM-DD)",e.jsx("input",{value:s.birthday,onChange:o("birthday"),placeholder:"05-30"})]}),e.jsxs("label",{children:["Home",e.jsx("input",{value:s.home,onChange:o("home"),placeholder:"City, State"})]})]}),e.jsxs("label",{children:["Favorite quote",e.jsx("input",{value:s.quote,onChange:o("quote")})]}),e.jsxs("div",{className:"grid two-col",children:[e.jsxs("label",{children:["Favorite thing 1",e.jsx("input",{value:s.favoriteThing1,onChange:o("favoriteThing1")})]}),e.jsxs("label",{children:["Favorite thing 2",e.jsx("input",{value:s.favoriteThing2,onChange:o("favoriteThing2")})]}),e.jsxs("label",{children:["Favorite thing 3",e.jsx("input",{value:s.favoriteThing3,onChange:o("favoriteThing3")})]}),e.jsxs("label",{children:["Favorite Dartmouth tradition",e.jsx("input",{value:s.favoriteDartmouthTradition,onChange:o("favoriteDartmouthTradition")})]})]}),e.jsxs("label",{children:["Fun fact",e.jsx("input",{value:s.funFact,onChange:o("funFact")})]}),e.jsxs("div",{className:"grid two-col roles-grid",children:[e.jsxs("label",{className:"checkbox-field",children:[e.jsx("input",{type:"checkbox",checked:s.dev,onChange:h("dev")})," Dev"]}),e.jsxs("label",{className:"checkbox-field",children:[e.jsx("input",{type:"checkbox",checked:s.des,onChange:h("des")})," Design"]}),e.jsxs("label",{className:"checkbox-field",children:[e.jsx("input",{type:"checkbox",checked:s.pm,onChange:h("pm")})," PM"]}),e.jsxs("label",{className:"checkbox-field",children:[e.jsx("input",{type:"checkbox",checked:s.core,onChange:h("core")})," Core"]}),e.jsxs("label",{className:"checkbox-field",children:[e.jsx("input",{type:"checkbox",checked:s.mentor,onChange:h("mentor")})," Mentor"]})]}),e.jsxs("label",{children:["Bio / about you",e.jsx("textarea",{value:s.bio,onChange:o("bio"),rows:3})]}),e.jsxs("label",{children:["Profile photo (upload)",e.jsxs("div",{className:"file-input-row",children:[e.jsx("input",{id:"profile-form-file",type:"file",accept:"image/*",onChange:P,className:"file-input-hidden"}),e.jsx("label",{htmlFor:"profile-form-file",className:"btn btn-secondary file-trigger",children:"Choose file"}),y&&e.jsx("span",{className:"muted",children:y})]})]}),b&&e.jsx("div",{className:"error-message",children:b}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:p.isPending,children:p.isPending?"Saving...":x?"Create profile":"Update profile"}),!x&&e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>c(`/profile/${i.id}`),children:"Cancel"})]})]})]})})};export{B as default};
